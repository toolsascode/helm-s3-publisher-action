<p align="center"><a href="https://github.com/toolsascode/protomagic"><image src="https://raw.githubusercontent.com/toolsascode/protomagic/main/assets/protomagic.png" style="width: 100px;"></a></p>

# Helm S3 Publisher for GitHub Action

Helm S3 Publisher is a small project with the purpose of helping in the process of publishing new helm charts using the helm s3 plugin already known by the community.

**See more:** <https://github.com/toolsascode/helm-s3-publisher>

## Changelog

Please refer to the [release page](https://github.com/toolsascode/helm-s3-publisher/releases) for the latest release notes.


## Usage

```yaml
- uses: toolsascode/helm-s3-publisher-action@main
  with:
    # (Optional) Enables helm installation
    # Default: 'false'
    setup-helm: false
    # (Optional) Enables installation of helm s3 plugin
    # Default: 'false'
    setup-helm-s3-plugin: false
    # (Required) Repository for searching and publishing the new version of the chart.
    repo-name: my-repo
    # (Required) List of charts directories separated by commas.
    # If the Git LS Tree feature is enabled, the CLI will attempt to identify all changed chart directories indicated in the PATHS parameter.
    # Example: "dir-chart-1,dir-chart-2"
    paths: /path/to/helm-charts
    # (Optional) Enable the Git LS Tree feature and automatically disables the CHART PATHS parameter if it was specified.
    # Default: 'true'
    git-ls-tree: true
    # (Optional) List of directories to ignore separated by commas.
    # Default: '.git, .github'
    exclude-paths: '.git, .github'
    # (Optional) Log level [debug, info, warn, error, fatal, panic].
    # default: 'info'
    log-level: 'info'
    # (Optional) Make some output more quiet.
    quiet: false
    # (Optional) Executes the entire process without performing any publishing operations.
    dry-run: false
    # (Optional) Generate report on helm charts published or not. [json, text and txt].
    # Default: 'json'
    report-type: 'json'
    # (Optional) Name of the report generated by the CLI.
    # Default: 'helm-s3-publisher'
    report-name: 'helm-s3-publisher'
    # (Optional) Directory where the report will be saved by the CLI.
    # Default: '.'
    report-path: '.'
    # S3 Object ACL to use for charts and indexes. Can be sourced from S3_ACL environment variable.
    s3-acl: ''
    # Set the content-type for the chart file. Can be sourced from S3_CHART_CONTENT_TYPE environment variable.
    # Default: 'application/gzip'
    s3-content-type: 'application/gzip'
    # (Optional) Forces the chart to be replaced if it already exists. This may cause the repository to lose the existing version's chart; use with caution.
    s3-force: false
    # The functionality incorporates the publication report into the GitHub Actions Summary.
    # Default: 'true'
    github-step-summary: true
```

## Example

```yaml
  - name: Helm Package
    uses: toolsascode/helm-s3-publisher-action@main
    with:
        setup-helm: true
        setup-helm-s3-plugin: true
        repo-name: 'my-repo-name'
        paths: ./
        git-ls-tree: true
        exclude-paths: '.git, .github'
        log-level: debug
        report-type: 'json'
        report-name: 'helm-s3-publisher'
        report-path: ./
```
